<!DOCTYPE html>
<html>
    <head>

        <script>
            // INIT

            function initfooter() {
                // document.getElementById('download-issue').setAttribute('href', downloadlocation);
                document.getElementById('download-issue-footer-link').setAttribute('href', downloadlocation["default"]);
                resetverticalbuttons()
                initfootnotes()
            }
        </script>

        <script>

            // FOOTNOTES

            // ⁰¹²³⁴⁵⁶⁷⁸⁹⁽⁾
            var superscriptList = [
                '⁰',
                '¹',
                '²',
                '³',
                '⁴',
                '⁵',
                '⁶',
                '⁷',
                '⁸',
                '⁹'
            ]

            function tosuperscript(num) {
                num = num.toString()
                nums = num.split('')

                for (let i = 0; i < nums.length; i++){
                    nums[i] = superscriptList[nums[i]]
                }

                return nums.join()
            }

            function initfootnotes() {
                console.log("initfootnotes")
                for (let i = 1; i < footnoteList.length + 1; i++) {
                    let number = tosuperscript(i)

                    let footnote = document.getElementById("f"+i)
                    footnote.className = 'footnote';
                    footnote.tabIndex = '0'
                    footnote.innerHTML = number;
                    footnote.addEventListener("mouseenter", selectfootnote)

                    let note = document.createElement('span');
                    note.className = 'note';
                    note.innerHTML = number + " " + footnoteList[(i-1)];

                    footnote.appendChild(note)
                }

                console.log("initfootnotes catch")
                console.log(localStorage.getItem("gefaengnishefte_cookies"))
                // catch footnotes loading after databanner
                if(localStorage.getItem("gefaengnishefte_cookies") != "true" && typeof hidecookiecontent === "function"){
                    console.log("initfootnotes hidecookiecontent")
                    hidecookiecontent();
                }
            }

            document.addEventListener("click", focusfootnote)
            var footnotefocused = "none";

            function focusfootnote(event) {
                if(event.target.className == "footnote") {
                    selectfootnote(event)
                }
                else if(footnotefocused != "none") {
                    if(!footnotefocused.contains(event.target)) {
                        resetfootnote()
                        pausevideos();
                    }
                }
            }

            function selectfootnote(event) {

                if(footnotefocused != "none") {
                    resetfootnote()
                }

                footnotefocused = event.target;

                footnotefocused.style.color = "#980000";
                footnotefocused.childNodes[1].style.zIndex = "19";
                footnotefocused.childNodes[1].style.display = "inline";
            }

            function resetfootnote() {
                footnotefocused.style.color = "black";
                footnotefocused.childNodes[1].style.zIndex = "0";
                footnotefocused.childNodes[1].style.display = "none";
                footnotefocused = "none";
            }

        </script>

        <script>

            // VERTICAL NAVIGATION

            var layoutList = ["info-wrapper", "posthistorische-klassenkaempfe", "der-neue-rahmen", "agieren-und-agitieren"]
            var layoutCurrent = 0

            function resetverticalbuttons() {
                if (layoutCurrent==0) {
                    document.getElementById("to-top").disabled = true;
                    document.getElementById("to-top").style.color = "lightgrey";
                }
                else {
                    document.getElementById("to-top").disabled = false;
                    document.getElementById("to-top").style.color = "white";
                }
                
                if (layoutCurrent==layoutList.length-1) {
                    document.getElementById("to-bottom").disabled = true;
                    document.getElementById("to-bottom").style.color = "lightgrey";
                }
                else {
                    document.getElementById("to-bottom").disabled = false;
                    document.getElementById("to-bottom").style.color = "white";
                }
            }

            function verticalup() {
                // var lastlay = layoutCurrent

                if(layoutCurrent > 0) {
                    layoutCurrent = layoutCurrent - 1
                    document.getElementById(layoutList[layoutCurrent]).scrollIntoView()
                    resetverticalbuttons()
                    // console.log("UP from " + lastlay + " to " + layoutCurrent)
                }
            }

            function verticaldown() {
                // var lastlay = layoutCurrent

                if(layoutCurrent < layoutList.length - 1) {
                    layoutCurrent = layoutCurrent + 1
                    document.getElementById(layoutList[layoutCurrent]).scrollIntoView()
                    resetverticalbuttons()
                    // console.log("DOWN from " + lastlay + " to " + layoutCurrent)
                }
            }
            

            document.getElementById("content").addEventListener("scroll", function() {
                
                var scrollheight = document.getElementById("content").scrollTop
                layoutCurrent = 0;
                // var contentheight = window.innerHeight
                // var lasti, last, offsetlast
                // var istop = true;
                for (let i = 0; i < layoutList.length; i++) {
                    // offsetlast = document.getElementById(layoutList[0]).offsetTop
                    if(scrollheight >=document.getElementById(layoutList[i]).offsetTop - 150){
                        layoutCurrent = i;
                        // offsetlast = document.getElementById(layoutList[i]).offsetTop
                        // last = layoutList[i]
                        // lasti = i
                        // istop = false;
                    }
                }

                resetverticalbuttons()

                // if(istop) {
                //     layoutCurrent = 0;
                //     offsetlast = document.getElementById(layoutList[0]).offsetTop
                    // last = layoutList[0]
                    // lasti = 0
                // }
                // console.log("SCROLLING: "+ Math.round(scrollheight) +"   \n element:"+last+" ("+offsetlast+" | "+layoutCurrent+")")
            })
        </script>

        <!-- <script>
            function sharenow () {
                if (navigator.share) {
                navigator.share({
                    title: 'web.dev',
                    text: 'Check out web.dev.',
                    url: 'https://web.dev/',
                })
                    .then(() => console.log('Successful share'))
                    .catch((error) => console.log('Error sharing', error));
                }
            }
        </script> -->

        <script>

            // COPY LINK

            var textOriginal;
            const textList = [];
            var textIndex = 0;

            function copyanchor(anchor, id, textReplace) {
                navigator.clipboard.writeText('https://www.gefaengnishefte.org/issue-i' + id);
                var text = anchor.innerHTML
                if (text != textReplace){
                    textOriginal = text;
                    textList.push(textOriginal)
                
                    anchor.innerHTML = textReplace;
                    setTimeout(function(){
                        anchor.innerHTML = textList[textIndex];
                        textIndex = textIndex + 1;
                        initlanguage()
                    }, 3000);
                }
                initlanguage()
            }
        </script>
    
        <script>

            // SHARE LINK

            function opensharewindow() {
                document.getElementById("sharewindow").style.display = "block"
            }

            function closesharewindow() {
                document.getElementById("sharewindow").style.display = "none"
            }
        </script>

        <style>

            /* RETURN TO TOP */

            #to-top, #to-bottom {
                cursor: pointer;
                font-size:13pt;
                position: fixed;
                right:20px;
                background-color: var(--header-color);
                color: var(--header-color-text);
                padding:0px;
                width: 45px;
                height: 45px;
                font-size: 35pt;
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            #to-top {bottom:110px;}
            #to-bottom {bottom:60px;}
            

            #to-top-label {
                position:relative;
                bottom:16px;
                left:2px;
                transform: rotate(90deg);
                -webkit-transform: rotate(90deg);
                -moz-transform: rotate(90deg);
                -ms-transform: rotate(90deg);
                -o-transform: rotate(90deg);
                -o-transform: rotate(90deg);
            }


            /* FOOTER */

            #footer {
                display: flex;
                justify-content: flex-end;
                align-items: center;
                color:white;
                position: absolute;
                height:fit-content;
                bottom:0;
                left:0;
                width:100%;
                z-index:8;
            }

            .footercontent {
                display: flex;
                justify-content: flex-end;
                align-items: flex-start;
                color:white;
                gap:10px;
                padding: 10px 20px;
                white-space: nowrap;
            }

            .footerelement {
                text-align: center;
                font-size: 12pt;
                width:180px;
                height:fit-content;
                cursor: pointer;
            }

            .footerelement * {
                color: black !important;
            }

            .inlinefooter {
                display: none;
                margin-bottom: 100px;
                width:100%;
                padding: 0 !important;
            }

            /* REACTIVE */

            @media screen and (max-width: 1750px), screen and (max-height: 1050px) {

                /* #content {
                    height: calc(var(--vh, 1vh) * 100 - 125px) !important;
                } */

                .footercontent {
                    display:none;
                    border:unset;
                    width:100%;
                    justify-content: space-between;
                    justify-content: center;
                    gap:10px 15px;
                    padding: 10px 30px;
                }

                .inlinefooter {
                    display: flex;
                    flex-wrap: wrap;
                }

                #to-top {bottom:70px;}
                #to-bottom {bottom:20px;}
            }

            @media screen and (max-width: 800px) {

                #to-top, #to-bottom {
                    right:30px;
                }
            }


            /* SHAREWINDOW */

            #sharewindow {
                display:none;
                position: fixed;
                left:50%;
                top:50%;
                transform: translate(-50%, -50%);
                max-width: 90vw;
                /* max-height: 80vh; */
                width: 400px;
                /* height: 400px; */
                background-color: #980000;
                border:outset grey;
            }

            #closesharewindow {
                font-size: 15pt;
                cursor: pointer;
                /* text-align: right; */
                /* width:100%; */
                padding:10px;
            }

            #shareoptions {
                display:flex;
                flex-wrap: wrap;
                gap:20px;
            }

            .shareoption {
                display:flex;
                flex-flow:column;
                align-items: center;
                width:100px;
                font-size: 13pt;
            }

            .shareimg {
                width:40px;
                height:40px;
            }

            .sharetxt {
                text-align: center;
            }

            #linkoptions {
                padding:10px;
                margin-bottom: 20px;
                line-height: 2;
            }

            #shareoptions {
                padding:10px;
                margin-bottom: 20px;
            }

            #link-kopieren {
                padding: 5px 20px;
                font-size: 15pt;
                margin-bottom:20px;
            }

            #link-kopierenwrap {
                display:flex;
                justify-content:center;
            }


        </style>
    </head>

    <body>

        <div id="footer">
            <button id="to-top" onclick="verticalup()"><div id="to-top-label">‹</div></button>
            <button id="to-bottom" onclick="verticaldown()"><div id="to-top-label">›</div></button>
            <!-- <button id="plus" onclick="showfooter()"><div id="to-top-label">+</div></button> -->

            <div class="footercontent">
                <button class="footerelement" id="teilen" onclick="opensharewindow()"><span lang="de">ISSUE teilen</span><span lang="en">Share ISSUE</span></button>
                <a id="download-issue-footer-link" download><button class="footerelement" id="download-issue-footer"><span lang="de">PDF herunterladen</span><span lang="en">Download PDF</span></button></a>
            </div>
        </div>

        <div id="sharewindow">
            <div id="closesharewindow" onclick="closesharewindow()">X</div>
            <div id="linkoptions">
                <span id="link1">ISSUE I - ALTERNATIVE UTOPIEN</span><br>
                <span id="link2">POSTHISTORISCHE KLASSENKÄMPFE</span><br>
                <span id="link3">DER NEUE RAHMEN</span><br>
                <span id="link4">AGIEREN & AGITIEREN</span><br>
            </div>
            <div id="link-kopierenwrap"><button id="link-kopieren">Link kopieren</button></div>
        </div>
        <!-- onclick="copyanchor(this, ``, `<span lang='de'></small>[Link kopiert!]</span><span lang='en'></small>[Link copied!]</span>`)" -->
    </body>
</html>