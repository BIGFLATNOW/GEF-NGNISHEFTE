<!DOCTYPE html>
<html>
    <head>
        <script>

            // PRELOAD

            let lang = localStorage.getItem("gefaengnishefte_language"); if(lang == null) {lang = "de"}
            let preload = '<link rel="preload" as="image" fetchpriority="high" href="images/issues/' + lang + '/issue-i-cover.WebP">'
            document.currentScript.insertAdjacentHTML("afterend", preload)
            

        </script>
        
        <meta charset="UTF-8">
        <title>ISSUES</title>
        <meta name="viewport" content="width=device-width, height=device-height, user-scalable=no">
        <meta name="description" content="Gedanken einer politisch desinteressierten Jugend.">
        <meta property="og:type" content="website"/>
        <meta property="og:site_name" content="GEFÄNGNISHEFTE"/>
        <meta property="og:title" content="ISSUES"/>
        <meta property="og:description" content="Gedanken einer politisch desinteressierten Jugend."/>
        <meta property="og:image" itemprop="image" content="https://www.gefaengnishefte.org/images/opengraph/red_2x1.jpg"/>
        <meta property="og:image:type" content="image/jpeg"/>
        <meta property="og:image:width" content="1200"/>
        <meta property="og:image:height" content="630"/>
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:image" content="https://www.gefaengnishefte.org/images/opengraph/red_1x1.jpg" />

        <!-- https://realfavicongenerator.net/ -->
        <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/red/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/red/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/red/favicon-16x16.png">
        <link rel="mask-icon" href="images/favicon/red/safari-pinned-tab.svg" color="#750000">
        <link rel="shortcut icon" href="images/favicon/red/favicon.ico">
        <meta name="apple-mobile-web-app-title" content="GEF&Auml;NGNISHEFTE">
        <meta name="application-name" content="GEF&Auml;NGNISHEFTE">
        <meta name="msapplication-TileColor" content="#000000">
        <meta name="msapplication-config" content="images/favicon/red/browserconfig.xml">
        <meta name="theme-color" content="#750000">

        <link rel="manifest" href="manifest.json">
        
        <link rel="stylesheet" href="styles/fonts.css">
        <link rel="stylesheet" href="styles/general.css">
        <link rel="stylesheet" href="styles/red.css">

        <link rel="preload" as="font" crossorigin type="font/woff2" href="https://www.gefaengnishefte.org/fonts/Spectral/Spectral-Regular.woff2">
        <link rel="preload" as="font" crossorigin type="font/woff2" href="https://www.gefaengnishefte.org/fonts/Spectral/Spectral-Bold.woff2">
        <link rel="preload" as="font" crossorigin type="font/woff2" href="https://www.gefaengnishefte.org/fonts/Spectral/Spectral-Italic.woff2">
        
        <link rel="preload" as="fetch" crossorigin href="components/header.html">
        <link rel="preload" as="fetch" crossorigin href="components/controls.html">
        <link rel="preload" as="fetch" crossorigin href="components/databanner.html">

        <script type="text/javascript" src="common.js"></script>
        <script>

            // VARIABLES
            
            const OVERRIDE_TITLE_TEXT = "<span class='title-large'><span lang='de'>ÜBERSICHT</span><span lang='en'>OVERVIEW</span></span><span class='title-small'>#</span>"

            const ISSUE_LIST = [
                {
                    no_de: "HEFT I",
                    no_en: "ISSUE I",
                    title_no: "title-i",
                    date_de: "MAI 2023",
                    date_en: "MAI 2023",
                    title_de: "ALTERNATIVE <br>UTOPIEN",
                    title_en: "ALTERNATIVE <br>UTOPIAS",
                    cover_de: "images/issues/de/issue-i-cover.WebP",
                    cover_en: "images/issues/en/issue-i-cover.WebP",
                    url: "heft-i"
                },
                {
                    no_de: "HEFT I",
                    no_en: "ISSUE I",
                    title_no: "title-ii",
                    date_de: "ENDE 2023",
                    date_en: "LATE 2023",
                    title_de: "REFORM ODER <br>REVOLUTION",
                    title_en: "REFORM OR <br>REVOLUTION",
                    cover_de: "images/issues/de/issue-ii-cover.WebP",
                    cover_en: "images/issues/en/issue-ii-cover.WebP",
                    url: "heft-ii"
                },
                {
                    no_de: "HEFT I",
                    no_en: "ISSUE I",
                    title_no: "title-ii",
                    date_de: "ANFANG 2024",
                    date_en: "EARLY 2024",
                    title_de: "RAT ODER <br>PARLAMENT",
                    title_en: "COUNCIL OR <br>PARLIAMENT",
                    cover_de: "images/issues/de/issue-ii-cover.WebP",
                    cover_en: "images/issues/en/issue-ii-cover.WebP",
                    url: "heft-ii"
                },
                {
                    no_de: "HEFT I",
                    no_en: "ISSUE I",
                    title_no: "title-ii",
                    date_de: "ENDE 2024",
                    date_en: "LATE 2024",
                    title_de: "IST POPULISMUS <br>GUT?",
                    title_en: "IS POPULISM <br>A GOOD THING?",
                    cover_de: "images/issues/de/issue-ii-cover.WebP",
                    cover_en: "images/issues/en/issue-ii-cover.WebP",
                    url: "heft-ii"
                },
                {
                    no_de: "HEFT I",
                    no_en: "ISSUE I",
                    title_no: "title-ii",
                    date_de: "ANFANG 2025",
                    date_en: "EARLY 2025",
                    title_de: "MATERIELLE <br>SYMBOLPOLITK",
                    title_en: "MATERIAL OR <br>SYMBOL POLITICS",
                    cover_de: "images/issues/de/issue-ii-cover.WebP",
                    cover_en: "images/issues/en/issue-ii-cover.WebP",
                    url: "heft-ii"
                }
            ]

            // TEMPLATES

            function cover_template(i){let issue = ISSUE_LIST[i]; return '<a class="cover" href=' + issue.url + '><img class="cover-image" loading="lazy" lang="de" src=' + issue.cover_de + ' alt=' + issue.no_de + ' COVER/><img class="cover-image" loading="lazy" lang="en" src=' + issue.cover_en + ' alt=' + issue.no_en + 'COVER/></a>'}
            function basic_template(issue) {return '<span lang="de">' + issue.no_de + '</span><span lang="en">' + issue.no_en + '</span><span lang="de">' + issue.title_de + '</span><span lang="en">' + issue.title_en + '</span>'}
            function basic_template_date(issue) {return '<span lang="de">' + issue.no_de + '&#x2005;&#x2005;&#x2005;&#x2005;' + issue.date_de +  '</span><span lang="en">' + issue.no_en + '&#x2005;&#x2005;&#x2005;&#x2005;' +  issue.date_en + '</span><span lang="de">' + issue.title_de + '</span><span lang="en">' + issue.title_en + '</span>'}
            function title_template(i){let issue = ISSUE_LIST[i]; return  cover_template(i) + '<a onmouseover="display_combined(' + i + ')" class="issue-title vertical" href=' + issue.url + '>' + basic_template_date(issue)+ '</a>'}
            function index_title_template(i){let issue = ISSUE_LIST[i]; return '<a class="issue-title center" href=' + issue.url + '>' + basic_template(issue) + '</a>'}
            function index_template(slide, i){let issue = ISSUE_LIST[i]; return '<span onclick="display_combined(' + i + ')" id="index' + i + '" class="indexitem issue-title">' + basic_template(issue) + '</span><hr>'}

            // LOADING

            load_components(["header", "controls", "databanner"])
            
        </script>

        <script>

            // COVERSCRIPT

            document.addEventListener("DOMContentLoaded", initcovers)


            function initcovers() {
                for (let i = 0; i < ISSUE_LIST.length; i++) {
                    document.getElementById("slides").insertAdjacentHTML('beforeend', cover_template(i));
                    document.getElementById("issue-library").insertAdjacentHTML('beforeend', title_template(i));
                }

                let issue_list = document.getElementById("issue-library")
                let default_cover = issue_list.getElementsByClassName("cover")[slide_current].style.display = "flex"
                let default_vertical = issue_list.getElementsByClassName("issue-title")[slide_current].style.display = "none"

                compute_sizes()
                seteagerload()
                init_prevent_touch_response()
            }

            
            // DISPLAY COMBINED

            var protected_hover = false

            function display_combined(index) {
                if(slide_current == index || protected_hover) {
                    display_slide(index)
                }
                else {
                    display_slide(index)
                    title_display(index)
                }
            }

            function title_display(index) {

                let issue_list = document.getElementById("issue-library")

                let titles = issue_list.querySelectorAll('.issue-title')
                titles.forEach((title) => {title.style.display = "flex"})

                let title_covers = issue_list.querySelectorAll('.cover')
                title_covers.forEach((title_cover) => {title_cover.style.display = "none"})


                let cover_animation = [
                    { width: "0", opacity: 0},
                    { width: GROWTH_WIDTH},
                    { opacity: 1},
                ];

                titles.item(index).style.display = "none";
                title_covers.item(index).style.display = "flex"
                title_covers.item(index).animate(cover_animation, {duration: 1000, iterations: 1})

                protected_hover = true
                setTimeout(() => {protected_hover = false}, 400)
            }

            // SIZE COMPUTING

            var GROWTH_WIDTH = 0

            function compute_sizes() {
                let images = document.getElementById("issue-library").getElementsByClassName("cover")[slide_current].getElementsByClassName("cover-image")
                let lang = localStorage.getItem("gefaengnishefte_language")
                let image 

                for (let i = 0; i < images.length; i++) {
                    if(images[i].lang == lang) {
                        image = images[i]
                    }
                }

                if(image == null) {
                    return
                }
                else if (image.complete) {
                    if(image.offsetWidth == 0) {
                        window.addEventListener("resize", compute_sizes)
                        console.log("IMAGE NOT MORE THAN 0")
                        return
                    }

                    GROWTH_WIDTH = image.offsetWidth + "px"
                    console.log(GROWTH_WIDTH)
                    window.removeEventListener("resize", compute_sizes)
                    compute_issue_list_width()
                }
                else {
                    console.log("IMAGE NOT YET LOADED")
                    setTimeout(compute_sizes, 10)
                }
            }

            function compute_issue_list_width() {

                let issue_list = document.getElementById("issue-library")

                if (issue_list.offsetWidth == 0) {
                    window.addEventListener("resize", compute_issue_list_width)
                    return
                }

                issue_list.style.width = issue_list.offsetWidth + "px"
                console.log(issue_list.offsetWidth + "px")
                window.removeEventListener("resize", compute_issue_list_width)
            }


            // EAGER LOAD ACCORDING TO LANGUAGE

            function seteagerload() {

                let covers = document.getElementById("slides").getElementsByTagName("img")
                let clang = localStorage.getItem("gefaengnishefte_language")
                
                for (let i = 0; i < covers.length; i++) {
                    if(covers[i].lang == lang) {
                        covers[i].loading = "eager"
                    }
                }
            }


            // PREVENT TOUCHING RESPONSE
            // DOES THIS EVEN CONNECT TO ANYTHING?

            function init_prevent_touch_response() {
                let titles = document.getElementsByClassName("title")

                for (let i = 0; i < titles.length; i++) {
                    titles[i].addEventListener("pointerdown", (event) => {
                        if (event.pointerType === "touch" || event.pointerType === "pen") {
                            event.currentTarget.addEventListener("click", prevent_link_events)
                        }
                    })

                    titles[i].addEventListener("mouseenter", ()=>{titles[i].style.color = ""})
                }
            }

            function prevent_link_events(event) {
                event.preventDefault()
                event.currentTarget.style.color = "white"
                event.currentTarget.removeEventListener("click", prevent_link_events)
            }

        </script>

        <style>

            #controls {
                display:none !important;
            }

            #content {
                display: grid;
                place-content: center;
            }

            /* WRAPS */                

            #issue-library {
                display: flex;
                flex-direction: row-reverse;
                justify-content: flex-end;
                align-items: center;
                gap: 20px;
                height: 500px;
                margin-bottom: 200px;
            }

            .vertical {
                color: black !important;
                background-color: white;
                box-shadow: 10px 10px 10px 0px rgba(0,0,0,0.35);
                padding: 25px 10px;
                height: 500px;
                writing-mode: vertical-rl;
                text-orientation: mixed;
                width: fit-content;
                font-weight: 700;
            }


            #slides {
                display: none;
            }

            #slide-index {
                width:100% !important;
                width:350px !important;
            }
            
            #slide-index > * {
                margin: 15px 0px;
            }


            /* COVERS */

            .cover {   
                display: flex;
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            .cover-image {
                object-fit: cover;
                cursor: pointer;
                transition: 0.7s;
                box-shadow: 10px 10px 10px 0px rgba(0,0,0,0.35);
            }



            #slides .cover { 
                min-width:300px;
                max-width:400px;
                justify-content: center;
            }

            #slides .cover-image {
                object-fit: contain;
                max-height: 55vh;
            }

            #slides .cover-image:hover {
                transform: scale(1.02);
            }



            #issue-library .cover {
                display: none;
                justify-content: flex-start;
                height: 500px;
            }

            #issue-library .cover-image {
                height:100%;
            }

            /* .title {
                display:flex;
                justify-content: space-between;
                white-space:nowrap;
                flex-wrap: wrap;
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
            } */

            /* SLIDES */

            #slide-index {
                line-height: 1 !important;
                width:100% !important;
                max-width:390px !important; 
            }
            /* TIED TO ISSUE LIST WITH PADDING */



            #slide-current {
                font-size: 15pt !important;
                width:160px !important;
                padding: 5px 15px 5px 15px !important;
            }

            .control_l {
                display: none!important;
            }

            .control_s {
                display: inline!important;
            }

            #letztes, #nächstes {
                padding:0px!important;
                font-size: 35pt!important;
                width: 45px !important;
            }


            /*/////////////////////// REACTIVE ///////////////////////*/


            @media screen and (max-width: 800px) {
                body {
                    grid-template-rows: auto minmax(0, 1fr) auto;
                    grid-template-areas: "header" "main" "controls";
                }
                
                #controls {
                    display:flex !important;
                }

                #issue-library {
                    display:none;
                }

                #slides {
                    display: block;
                }

                .cover {
                    min-width:unset;
                }

                #issue-wrap {
                    padding: 0px;
                }
            }


            /* SMALL SCREEN ADJUSTMENTS */
            

            #slide-title {
                font-size: 1.25rem !important;
	            font-size: clamp(1rem, -0.54rem + 5.7vw, 1.25rem) !important;
            }

            #slide-index {
                font-size: 1rem !important;
            }

            .title-small {
                display: none;
            }

            @media screen and (max-width: 320px) {

                .title-small {
                    display: inline;
                }

                .title-large {
                    display: none;
                }

                #slide-current {
                    padding:0px !important;
                    width: 45px !important;
                    font-size: 20pt !important;
                }
            }


        </style>
    </head>

    <body>
        <header id="header"></header>

        <main id="content">
            <div id="issue-library"></div>
            <div id="slides"></div>
        </main>
        
        <div id="controls"></div>
        <div id="databanner"></div>
    </body>
</html>